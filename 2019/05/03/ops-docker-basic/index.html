<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/Dong_small.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Dong_medium.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Dong_small.ico">
  <link rel="mask-icon" href="/images/Dong_small.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blackist.org","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Linux Containers Linux容器 缩写LXC，其对进程进行隔离，而非一个完整的操作系统。Docker属于LXC的一种封装，提供简单易用的容器使用接口。Docker主要用于提供一次性环境、提供 弹性的云服务、组件微服务架构。">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker入门">
<meta property="og:url" content="https://blackist.org/2019/05/03/ops-docker-basic/index.html">
<meta property="og:site_name" content="Thinking in Coding">
<meta property="og:description" content="Linux Containers Linux容器 缩写LXC，其对进程进行隔离，而非一个完整的操作系统。Docker属于LXC的一种封装，提供简单易用的容器使用接口。Docker主要用于提供一次性环境、提供 弹性的云服务、组件微服务架构。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-05-03T12:51:42.000Z">
<meta property="article:modified_time" content="2022-08-24T03:09:53.359Z">
<meta property="article:author" content="董猿外">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="OPS">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blackist.org/2019/05/03/ops-docker-basic/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blackist.org/2019/05/03/ops-docker-basic/","path":"2019/05/03/ops-docker-basic/","title":"Docker入门"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Docker入门 | Thinking in Coding</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Thinking in Coding</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">一、基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Docker%E5%AE%89%E8%A3%85"><span class="nav-text">1.1 Docker安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Docker%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6image"><span class="nav-text">1.2 Docker镜像文件image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Docker%E9%95%9C%E5%83%8F%E5%AE%9E%E4%BE%8B"><span class="nav-text">1.3 Docker镜像实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hello-world"><span class="nav-text">hello-world</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-Docker%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B"><span class="nav-text">1.4 Docker运行容器实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%B9%E5%99%A8"><span class="nav-text">二、自定义容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%87%86%E5%A4%87%E9%95%9C%E5%83%8F%E6%89%80%E9%9C%80%E7%9A%84%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%88%96%E6%96%87%E4%BB%B6"><span class="nav-text">2.1 准备镜像所需的工程代码或文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%BC%96%E5%86%99Docker%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">2.2 编写Docker配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FROM-openjdk-8"><span class="nav-text">FROM openjdk:8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VOLUME-x2F-tmp"><span class="nav-text">VOLUME &#x2F;tmp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ADD"><span class="nav-text">ADD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXPOSE-8000"><span class="nav-text">EXPOSE 8000</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ENTRYPOINT"><span class="nav-text">ENTRYPOINT</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E7%BC%96%E8%AF%91Docker%E9%95%9C%E5%83%8F"><span class="nav-text">2.3 编译Docker镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="nav-text">2.4 运行容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="董猿外"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">董猿外</p>
  <div class="site-description" itemprop="description">Coding in Thinking.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">79</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">80</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blackist" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blackist" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/liangl.dong@gmail.com" title="E-Mail → liangl.dong@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/liangl_dong" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;liangl_dong" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blackist.org/2019/05/03/ops-docker-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="董猿外">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thinking in Coding">
      <meta itemprop="description" content="Coding in Thinking.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Docker入门 | Thinking in Coding">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker入门
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-03 20:51:42" itemprop="dateCreated datePublished" datetime="2019-05-03T20:51:42+08:00">2019-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-24 11:09:53" itemprop="dateModified" datetime="2022-08-24T11:09:53+08:00">2022-08-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OPS/" itemprop="url" rel="index"><span itemprop="name">OPS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Linux Containers Linux容器 缩写LXC，其对进程进行隔离，而非一个完整的操作系统。Docker属于LXC的一种封装，提供简单易用的容器使用接口。Docker主要用于提供一次性环境、提供 弹性的云服务、组件微服务架构。</p>
<span id="more"></span>

<h2 id="一、基本操作"><a href="#一、基本操作" class="headerlink" title="一、基本操作"></a>一、基本操作</h2><h3 id="1-1-Docker安装"><a href="#1-1-Docker安装" class="headerlink" title="1.1 Docker安装"></a>1.1 Docker安装</h3><p>Docker是一个开源的开品，有两个版本：CE（Community Edition）和EE（Enterprise Edition）。企业版包含一些收费服务，社区版适合个人开发者。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/">Ubuntu</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/centos/">CentOS</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker-cn.com/docker-for-mac/install/">Mac</a></li>
</ul>
<p>安装完成后，使用如下命令验证是否安装成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -version</span><br></pre></td></tr></table></figure>
<p>Docker需要用户具有sudo权限，为了避免每次输入sudo以及用户不具有sudo权限，请先使用管理员用户将特定的用户添加到Docker用户组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G docker $USER</span><br></pre></td></tr></table></figure>

<p>Docker 是服务器—-客户端架构。命令行运行docker命令的时候，需要本机有 Docker 服务。如果这项服务没有启动，可以用下面的命令启动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 启动Docker服务</span><br><span class="line">sudo service docker start</span><br><span class="line"># 设置开启自己懂</span><br><span class="line">systemctl enable docker.service</span><br><span class="line"># 检查开机自启动设置成功没</span><br><span class="line">systemctl list-unit-files |grep docker</span><br><span class="line"></span><br><span class="line">docker.service                             enabled </span><br><span class="line">docker.socket                              enabled </span><br></pre></td></tr></table></figure>

<h3 id="1-2-Docker镜像文件image"><a href="#1-2-Docker镜像文件image" class="headerlink" title="1.2 Docker镜像文件image"></a>1.2 Docker镜像文件image</h3><p>Docker将应用程序及其依赖打包在镜像（image）文件里，通常一个image会继承自另一个image，开发者在其中加入个性化的配置，从而形成定制化的镜像文件。</p>
<p>Docker通过image来生成并运行虚拟容器。比如说我们的网站程序打包成image文件并拷贝在一个服务器上，通过docker根据此image文件在服务器上生成并运行多个相同的网站程序。</p>
<p>通过Docker管理image文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 列出本机的image文件</span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line"># 删除本机image文件</span><br><span class="line">docker image rm $image_name</span><br></pre></td></tr></table></figure>

<p>image具备复用性，通常我们可以使用别人制作好的Image文件，这些共享镜像通常来自于<a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a>。</p>
<h3 id="1-3-Docker镜像实例"><a href="#1-3-Docker镜像实例" class="headerlink" title="1.3 Docker镜像实例"></a>1.3 Docker镜像实例</h3><p>我们可以从Docker官方镜像仓库&#x2F;第三方仓库拉取image文件并运行。</p>
<h4 id="hello-world"><a href="#hello-world" class="headerlink" title="hello-world"></a>hello-world</h4><p>从官方拉取hello-world镜像来感受下Docker：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull library/hello-world</span><br></pre></td></tr></table></figure>

<ul>
<li>docker image pull：拉取镜像的命令</li>
<li>library：镜像文件所在组</li>
<li>hello-world：镜像文件的名字</li>
</ul>
<p>Docker官方提供的镜像文件都在library下，因此library是默认镜像组，可省略不写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull hello-world</span><br></pre></td></tr></table></figure>


<h3 id="1-4-Docker运行容器实例"><a href="#1-4-Docker运行容器实例" class="headerlink" title="1.4 Docker运行容器实例"></a>1.4 Docker运行容器实例</h3><p>基于image文件生成并运行容器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker container run hello-world</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>输出一段话后，hello-world容器自动终止。</p>
<p>有些容器不会自动终止，因为它们提供的是服务例如网站容器和虚拟操作系统容器，运行ubuntu的容器，docker会从镜像仓库下载ubuntu的镜像，下载完成后直接从ubuntu镜像运行容器实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker container run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Unable to find image &#x27;ubuntu:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/ubuntu</span><br><span class="line">f476d66f5408: Pull complete</span><br><span class="line">...</span><br><span class="line">Status: Downloaded newer image for ubuntu:latest</span><br><span class="line">root@341a7595b69e:</span><br></pre></td></tr></table></figure>
<ul>
<li>-t: flag assigns a pseudo-tty or terminal inside the new container.</li>
<li>-i: flag allows you to make an interactive connection by grabbing the standard in (STDIN) of the container.</li>
<li>-it：Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器</li>
<li>bash: launches a Bash shell inside our container.</li>
</ul>
<p>输入exit或按Ctrl+D可退出此ubuntu容器实例进程，此种方式依赖命令行运行，命令行退出则容器进程终止（使用Ctrl+P+Q也可退出容器且不关闭容器）。使用ps命令查看docker进程，可见ubuntu的进程已退出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED       STATUS    </span><br><span class="line">341a7595b69e        ubuntu              &quot;bash&quot;              2 minutes ago       Exited </span><br><span class="line"></span><br><span class="line">44a7468dabfd        hello-world         &quot;/hello&quot;            23 minutes ago      Exited </span><br></pre></td></tr></table></figure>

<p>也可以将将容器作为后台进程运行，再使用attach命令进入在后台运行的容器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker container run -itd ubuntu</span><br><span class="line">1f7b446e9a8f6a9e9ec8066526f055222c9cfb6bf75f5389a8a9163428d53272</span><br><span class="line"></span><br><span class="line">docker ps -a </span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED       STATUS</span><br><span class="line">1f7b446e9a8f        ubuntu              &quot;bash&quot;              13 seconds ago      Up 11 seconds</span><br><span class="line"></span><br><span class="line">341a7595b69e        ubuntu              &quot;bash&quot;              2 minutes ago       Exited </span><br><span class="line"></span><br><span class="line">44a7468dabfd        hello-world         &quot;/hello&quot;            23 minutes ago      Exited </span><br></pre></td></tr></table></figure>
<p>容器在后台运行成功，使用attach&#x2F;exec命令进入后台进程的ubuntu容器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># docker attach [OPTIONS] CONTAINER</span><br><span class="line">docker attach 1f7b446e9a8f</span><br><span class="line"></span><br><span class="line"># docker exec [OPTIONS] CONTAINER COMMAND [PARAMS]</span><br><span class="line">docker exec 1f7b446e9a8f bash</span><br><span class="line"></span><br><span class="line">root@1f7b446e9a8f:/#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>容器进程退出，但容器文件依然存在，因此关闭容器不会删除容器文件。一些container常用命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 启动容器</span><br><span class="line">docker start CONTAINER</span><br><span class="line"># 50s内停止容器，否则强制停止</span><br><span class="line">docker stop -t 50 CONTAINER</span><br><span class="line"># 强制停止容器</span><br><span class="line">docker kill CONTAINER</span><br><span class="line"># 重启容器</span><br><span class="line">docker restart CONTAINER</span><br><span class="line"># 删除容器文件</span><br><span class="line">docker rm CONTAINER</span><br></pre></td></tr></table></figure>

<h2 id="二、自定义容器"><a href="#二、自定义容器" class="headerlink" title="二、自定义容器"></a>二、自定义容器</h2><p>使用Dockerfile来定制image，适应我们自己的需要。Dockerfile是一个文本配置文件，docker将根据它生成我们需要的image。</p>
<h3 id="2-1-准备镜像所需的工程代码或文件"><a href="#2-1-准备镜像所需的工程代码或文件" class="headerlink" title="2.1 准备镜像所需的工程代码或文件"></a>2.1 准备镜像所需的工程代码或文件</h3><p>拉取测试代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/blackist/maven-quiz.git</span><br></pre></td></tr></table></figure>
<p>在本地编译maven项目，mvn clean package编译出需要的war包。</p>
<blockquote>
<p>也可基于maven镜像，在容器内构建maven项目，但需要令行配置</p>
</blockquote>
<h3 id="2-2-编写Docker配置文件"><a href="#2-2-编写Docker配置文件" class="headerlink" title="2.2 编写Docker配置文件"></a>2.2 编写Docker配置文件</h3><p>在此项目基础上构建Dockerfile项目，新建Dockerfile配置文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8</span><br><span class="line">VOLUME /tmp</span><br><span class="line">ADD ./target/maven-quiz.jar /app.jar</span><br><span class="line">EXPOSE 8000</span><br><span class="line">ENTRYPOINT [&quot;nohup&quot;, &quot;java&quot;, &quot;-Dserver.port=8000&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;, &quot;&amp;&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="FROM-openjdk-8"><a href="#FROM-openjdk-8" class="headerlink" title="FROM openjdk:8"></a>FROM openjdk:8</h4><p>基于openjdk8镜像编译自定义镜像</p>
<h4 id="VOLUME-x2F-tmp"><a href="#VOLUME-x2F-tmp" class="headerlink" title="VOLUME &#x2F;tmp"></a>VOLUME &#x2F;tmp</h4><p>将本地文件夹挂载到当前容器</p>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p> ADD .&#x2F;target&#x2F;maven-quiz.jar &#x2F;app.jar 是拷贝war文件到容器</p>
<h4 id="EXPOSE-8000"><a href="#EXPOSE-8000" class="headerlink" title="EXPOSE 8000"></a>EXPOSE 8000</h4><p>开放8000端口</p>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>ENTRYPOINT [“nohup”, “java”, “-Dserver.port&#x3D;8000”, “-jar”, “&#x2F;app.jar”, “&amp;”]<br>配置容器启动后执行的命令，使用nohup使得java程序运行于后台，不至于命令行退出java程序终止。</p>
<ul>
<li>ENTRYPOINT，表示镜像在初始化时需要执行的命令，不可被重写覆盖，需谨记</li>
<li>CMD，表示镜像运行默认参数，可被重写覆盖</li>
<li>ENTRYPOINT&#x2F;CMD都只能在文件中存在一次，并且最后一个生效 多个存在，只有最后一个生效，其它无效！</li>
<li>需要初始化运行多个命令，彼此之间可以使用 &amp;&amp; 隔开，但最后一个须要为无限运行的命令，需切记！</li>
</ul>
<p>ENTRYPOINT&#x2F;CMD，一般两者可以配合使用，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT [&quot;/usr/sbin/sshd&quot;] </span><br><span class="line">CMD [&quot;-D&quot;]</span><br></pre></td></tr></table></figure>

<h2 id="2-3-编译Docker镜像"><a href="#2-3-编译Docker镜像" class="headerlink" title="2.3 编译Docker镜像"></a>2.3 编译Docker镜像</h2><p>编译命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t maven-quiz .</span><br></pre></td></tr></table></figure>

<ul>
<li>docker build 或 docker image build：编译命令</li>
<li>-t：指定镜像的name，maven-quiz为镜像名，其后可加:来指定标签，默认为lastest</li>
<li>.：指定Dockerfile配置文件所在路径，.即是当前路径</li>
</ul>
<p>编译过程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Sending build context to Docker daemon  16.87MB</span><br><span class="line">Step 1/5 : FROM openjdk:8</span><br><span class="line"> ---&gt; b8d3f94869bb</span><br><span class="line">Step 2/5 : VOLUME /tmp</span><br><span class="line"> ---&gt; Running in dd6790b892cc</span><br><span class="line">Removing intermediate container dd6790b892cc</span><br><span class="line"> ---&gt; c22a0db1f2e0</span><br><span class="line">Step 3/5 : ADD ./target/maven-quiz.jar /app.jar</span><br><span class="line"> ---&gt; 3a7eb1b80968</span><br><span class="line">Step 4/5 : EXPOSE 8000</span><br><span class="line"> ---&gt; Running in 95ea426741b7</span><br><span class="line">Removing intermediate container 95ea426741b7</span><br><span class="line"> ---&gt; b472a3d4e0d5</span><br><span class="line">Step 5/5 : ENTRYPOINT [&quot;nohup&quot;, &quot;java&quot;, &quot;-Dserver.port=8000&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;, &quot;&amp;&quot;]</span><br><span class="line"> ---&gt; Running in c95c9393b88f</span><br><span class="line">Removing intermediate container c95c9393b88f</span><br><span class="line"> ---&gt; 48aa6f27aecf</span><br><span class="line">Successfully built 48aa6f27aecf</span><br><span class="line">Successfully tagged maven-quiz:latest</span><br></pre></td></tr></table></figure>

<h3 id="2-4-运行容器"><a href="#2-4-运行容器" class="headerlink" title="2.4 运行容器"></a>2.4 运行容器</h3><p>运行命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8000:8000 -itd maven-quiz</span><br></pre></td></tr></table></figure>
<p>-docker run：运行容器</p>
<ul>
<li>-p：指定本地：容器端口映射</li>
<li>-itd：容器在后台运行</li>
<li>maven-quiz：指定镜像，:后加标签，默认为lastest</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhezhebie/article/details/75501149">https://blog.csdn.net/zhezhebie/article/details/75501149</a></p>
<p><a target="_blank" rel="noopener" href="http://book.itmuch.com/3%20%E4%BD%BF%E7%94%A8Docker%E6%9E%84%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1/3.6%20%E4%BD%BF%E7%94%A8Dockerfile%E6%9E%84%E5%BB%BADocker%E9%95%9C%E5%83%8F.html">http://book.itmuch.com/3%20%E4%BD%BF%E7%94%A8Docker%E6%9E%84%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1/3.6%20%E4%BD%BF%E7%94%A8Dockerfile%E6%9E%84%E5%BB%BADocker%E9%95%9C%E5%83%8F.html</a></p>
<p>（完）</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>董猿外
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://blackist.org/2019/05/03/ops-docker-basic/" title="Docker入门">https://blackist.org/2019/05/03/ops-docker-basic/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/OPS/" rel="tag"># OPS</a>
              <a href="/tags/Docker/" rel="tag"># Docker</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/03/31/android-modulize-mvp/" rel="prev" title="Android组件化-MVP设计模式">
                  <i class="fa fa-chevron-left"></i> Android组件化-MVP设计模式
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/05/22/distributed-outline/" rel="next" title="分布式-开启SpringBoot微服务之旅">
                  分布式-开启SpringBoot微服务之旅 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">自由转载-非商用-非衍生-保持署名（<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN/">创意共享4.0许可证</a>）</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"blackist","repo":"blackist.github.io","client_id":"506775736a1ab7d38a56","client_secret":"b1c3f0dc07680f22f07a585fc81cd5288adb6729","admin_user":"blackist","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"21855e391defaa6c5743d328dab7ba8f"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
